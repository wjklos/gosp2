# This file is a template, and might need editing before it works on your project.
image: golang:1.10

variables:
  # Please edit to your GitLab project
  REPO_NAME: github.com/captech/gosp2

# Create a symbolic link under $GOPATH, this is needed for local build
# i.e. /go/src/gitlab.com/ykyuen/gitlab-ci-go-build
before_script:
    - go get "github.com/gin-gonic/gin"
    - echo $GOPATH
    - echo $CI_PROJECT_NAMESPACE
    - echo $CI_PROJECT_DIR
    - echo $CI_PROJECT_NAME
    - ln -s /builds /go/src/github.com
    # - cd $GOPATH/src
    # - mkdir -p github.com/$CI_PROJECT_NAMESPACE
    # - cd github.com/$CI_PROJECT_NAMESPACE
    # - ln -s $CI_PROJECT_DIR
    # - cd $CI_PROJECT_NAME

stages:
    - test
    - build

format:
    stage: test
    script:
      - go fmt $(go list ./... | grep -v /vendor/)
      - go vet $(go list ./... | grep -v /vendor/)
      #- go test -race $(go list ./... | grep -v /vendor/)

compile:
    stage: build
    script:
      - go build -race -ldflags "-extldflags '-static'" -o $GOPATH/src/mybinary
    artifacts:
      paths:
        - mybinary
